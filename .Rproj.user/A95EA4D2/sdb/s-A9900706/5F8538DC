{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Analisis del personal\"\nauthor: \"Luis Espinosa Bouvy\"\ndate: \"12 de enero de 2017\"\noutput: html_document\n---\n\n```{r leer, include=FALSE, echo=FALSE}\nrequire(dplyr)\nrequire(ggplot2)\nrequire(tidyr)\nrequire(lubridate)\nrequire(plotly)\nrequire(gridExtra)\n     \n#DB HISTORIAL#\n#--------------------------------------------\n\n    classes.hist <- c(NUM = \"factor\", DSDNUM = \"factor\", NOMBRE = \"character\", \n                       FECHA = \"Date\", FMOVIM = \"Date\", ADSDNUM = \"factor\", \n                       ADEPTO = \"factor\", OBSERVA = \"character\", DOBSER = \"character\")\n     historial <- read.csv(\"historial-clean.csv\", colClasses = classes.hist)\n     historial <- historial%>%select(-MOV.TIPO)\n     \n     #renombrar movimientos A-alta, B-baja, C-cambio, R-reingreso\n     mov.tipo <- data.frame(\"MVTO\" = c(\"A\",\"B\",\"C\",\"R\"), \n                            \"MOV.TIPO\" = c(\"ALTA\",\"BAJA\",\"CAMBIO\",\"ALTA-REINGRESO\"))\n     historial <- merge(historial, mov.tipo, by = \"MVTO\")\n     \n     #anio y mes de entrada\n     historial$ANIO.INGRESO <- year(historial$FECHA)\n     historial$MES.INGRESO <- month(historial$FECHA)\n     \n     #meses completos\n     historial <- historial[historial$FECHA < \"2016-10-01\",]\n     \n\n```\n\n\n```{r tabla_general, echo=FALSE, include=FALSE}\nrequire(lubridate)\n\n\n#DB GENERALES#\n#--------------------------------------------\n\n classes.gral <- c(NUM = \"factor\", edo.civil.fit = \"factor\", ingreso = \"Date\")\n     generales <- read.csv(\"OperDataclean.csv\", colClasses = classes.gral)\n     \n     #quien se queda un mes, tres y seis meses\n     generales$unmes<- ifelse(generales$meses.antiguedad>=1, 1,0)\n     generales$tresmeses <- ifelse(generales$meses.antiguedad>=3, 1,0)\n     generales$seismeses <- ifelse(generales$meses.antiguedad>=6, 1, 0)\n     #redondea sueldos a cerrados\n     generales$sueldo <- ceiling(generales$sueldo/100)*100\n     \n     #año ingreso\n     generales$anio.ingreso <- year(generales$ingreso) \n     \n     #span para gráfica loess- mujeres\n          mspan = 0.8\n          hspan = 0.5\n```\n\n##Altas y bajas\n```{r, altas-bajas-porano, echo=FALSE, fig.height=6, fig.width=10}\n\n     por.year <- historial%>%\n     filter(ANIO.INGRESO >= 2013 & MOV.TIPO != \"CAMBIO\")%>%\n     group_by(ANIO.INGRESO, MOV.TIPO)%>%\n     summarise(\"CUENTA\" = n())\n\n     g <- ggplot(data = por.year, aes(ANIO.INGRESO, CUENTA, colour = MOV.TIPO)) + \n          geom_point() + geom_line()+ \n          xlab(\"Anio\") + \n          ylab(\"Total personas\") +\n          ggtitle(\"MOVIMIENTOS POR AÑO\")\n     \n     ggplotly()\n\n```\n\n```{r, altas-bajas-poranomes, echo=FALSE, fig.height=6, fig.width=10}     \n     \npor.year.mes <- historial%>%\n     filter(ANIO.INGRESO %in% c(\"2013\",\"2014\",\"2015\",\"2016\") & MOV.TIPO != \"CAMBIO\")%>%\n     group_by(ANIO.INGRESO, MES.INGRESO,  MOV.TIPO)%>%\n     summarise(\"CUENTA\" = n())\n\n     g <- ggplot(data = por.year.mes, aes(MES.INGRESO, CUENTA, colour = MOV.TIPO)) + \n          geom_line() + \n          facet_wrap(~ANIO.INGRESO) + \n          xlab(\"Año\") + \n          ylab(\"Total personas\") +\n          ggtitle(\"MOVIMIENTOS POR MES / AÑO\") + \n          scale_x_continuous(breaks = c(1:12))\n     \n     ggplotly()\n     \n```\n\n###Meses de antiguedad generados en la fábrica de altas en 2016\n```{r histograma-antiguedad-2016, echo=FALSE, fig.height=6, fig.width=10}\n\n    tabla <- generales%>%filter(anio.ingreso==2016)%>%\n          mutate (total = n())%>%\n          group_by(meses.antiguedad, total)%>%\n          summarise (\"Cuenta\"=n()) %>%\n     mutate (Frec.relativa = round(Cuenta / total,2))%>%\n     select(\"Meses\" = meses.antiguedad, Cuenta, Frec.relativa)\n\n\n     ggplot(data = generales%>%filter(anio.ingreso == 2016), aes(meses.antiguedad, fill = sexo)) + \n     geom_histogram(bins = 10) + \n     xlab(\"Antiguedad en meses\") + \n     ylab(\"Cuenta\") + \n     ggtitle(\"Frecuencia de antiguedad - altas de personal 2016\") + \n     scale_x_continuous(breaks = c(0:12)) \n\n```\n\n```{r tabla.antiguedad, echo = F, comment=\"\", fig.height=6, fig.width=10}\n\n    tabla <- generales%>%filter(anio.ingreso==2016)%>%\n          mutate (total = n())%>%\n          group_by(meses.antiguedad, total)%>%\n          summarise (\"Cuenta\"=n()) %>%\n     mutate (Frec.relativa = round(Cuenta / total,2))%>%\n     select(\"Meses\" = meses.antiguedad, Cuenta, Frec.relativa)\n\n     ggplot(data = tabla, aes(Meses, cumsum(Frec.relativa))) + geom_line() + \n          geom_point(aes(Meses, Frec.relativa), size = 2, col = \"green\") + \n          xlab(\"Meses antiguedad\") + \n          ylab(\"Porcentaje del personal que se dio de alta\") + \n          ggtitle(\"Antiguedad vs % del personal que se dio de alta en 2016\") + \n          scale_x_continuous(breaks = c(0:11)) + \n          geom_label(aes(label = cumsum(Frec.relativa)))\n\n```\n\n##SUELDOS\n###MUJERES - Sueldos vs probabilidad de quedarse\n```{r, sueldo-femenino, echo=FALSE, fig.height=6, fig.width=10}\n     for.fit.women <- generales%>%\n          filter(anio.ingreso >= 2014, sexo == \"femenino\", \n                 sueldo.min.fit >= 700, sueldo.min.fit < 1400)\n\n     pl2 <- ggplot(data = for.fit.women, \n            aes(x = sueldo.min.fit, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 xlab(\"Sueldo semanal INICIAL\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"MUJERES - TRES MESES\")\n     \n     pl1 <- ggplot(data = for.fit.women, \n       aes(x = sueldo.min.fit, y= unmes, colour = factor(anio.ingreso))) +\n            geom_count(alpha = 0.5) + \n            facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n            geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) +\n            xlab(\"Sueldo semanal INICIAL\") +\n            ylab(\"Probabilidad\") + \n            ggtitle(\"MUJERES - UN MES\")\n\n     grid.arrange(pl1, pl2, ncol=2)\n     \n\n\n     \n```\n\n###Detalles TRES MESES\n```{r detalles-fem-tresmes,  echo=FALSE, fig.height=6, fig.width=10}\n\n     pl2b <- ggplot(data = for.fit.women, \n            aes(x = sueldo.min.fit, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 geom_smooth(method = \"loess\", span = mspan, se = FALSE, lwd=0.5, show.legend = T) +\n                 xlab(\"Sueldo semanal INICIAL\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"MUJERES - Sueldo vs probabilidad de durar 3 meses\")\n\n     suppressWarnings(ggplotly())\n```\n\n###HOMBRES - Sueldos vs probabilidad de quedarse\n```{r, sueldo-masculino, echo=FALSE, fig.height=6, fig.width=10}\n     for.fit.men <- generales%>%\n          filter(anio.ingreso >= 2014, sexo == \"masculino\", \n                 sueldo.min.fit >= 700, sueldo.min.fit < 2100)\n     pl5 <- ggplot(data = for.fit.men, \n            aes(x = sueldo.min.fit, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 xlab(\"Sueldo semanal\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"HOMBRES - TRES MESES\")\n     \n     pl4 <- ggplot(data = for.fit.men, \n            aes(x = sueldo.min.fit, y= unmes, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 xlab(\"Sueldo semanal\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"HOMBRES - UN MES\")\n     \n\n\n     \n     grid.arrange(pl4, pl5, ncol=2)\n     \n```\n\n###Detalles TRES MESES\n```{r detalles-masc-tresmes,  echo=FALSE, fig.height=6, fig.width=10}\n     pl5b <- ggplot(data = for.fit.men, \n            aes(x = sueldo.min.fit, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) +\n                 geom_smooth(method = \"loess\", span = hspan, se = FALSE, lwd=0.5) +\n                 xlab(\"Sueldo semanal\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"HOMBRES - TRES MESES\")\n\n     suppressWarnings(ggplotly())\n```\n\n##Probabilidad de quedarse cuando se aumenta de sueldo\n```{r prob-dias-aumento,  echo=FALSE, fig.height=6, fig.width=10}\n     \n     for.fit.dias.aumento <- generales%>%\n          filter(anio.ingreso >= 2014, \n                 sueldo >= 700)%>%\n          mutate(\"aumento.bool\" = ifelse(dias.para.aumento>0 & dias.para.aumento <=30,1,0))\n\n     pbaum1 <- ggplot(data = for.fit.dias.aumento, \n            aes(x = aumento.bool, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 2) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) +\n                 xlab(\"Días para aumentar su sueldo\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"Cuando se aumenta su sueldo antes de 1 meses\")+\n               scale_x_continuous(breaks = c(0,1), labels = c(\"No aumento\",\"Con aumento\"))\n     \n     suppressWarnings(ggplotly())\n     \n     for.fit.dias.aumento <- generales%>%\n     filter(anio.ingreso >= 2014, \n            sueldo >= 700)%>%\n     mutate(\"aumento.bool\" = ifelse(dias.para.aumento>0 & dias.para.aumento <=90,1,0))\n     \n     pbaum2 <- ggplot(data = for.fit.dias.aumento, \n            aes(x = aumento.bool, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 2) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) +\n                 xlab(\"Días para aumentar su sueldo\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"Cuando se aumenta su sueldo antes de 3 meses\")+\n               scale_x_continuous(breaks = c(0,1), labels = c(\"No aumento\",\"Con aumento\"))\n     suppressWarnings(ggplotly())\n\n```\n\n###Top 5% puestos con más altas en 2015-2016\n```{r, altas-puesto, echo=FALSE, fig.height=6, fig.width=10}\n     \n     top.ten.puesto <- generales%>%\n          filter(anio.ingreso >= 2015)%>%\n     group_by(puesto.fit)%>%\n     summarise(\"altas\" = n())%>%\n     arrange(desc(altas))%>%\n     filter(altas >= quantile(altas, probs = 0.95))\n\n     g<- ggplot(data = generales%>%filter(anio.ingreso >=2015, puesto.fit %in% top.ten.puesto$puesto.fit), \n                aes(puesto.fit, fill = sexo)) + geom_bar()+\n          facet_wrap(~anio.ingreso, ncol = 1)+\n          xlab(\"Puesto\") + \n          ylab(\"Cantidad de altas\") + \n          ggtitle(\"Top 5% altas por puesto 2016\")\n     \n     ggplotly()\n     \n```\n\n###Probabilidad quedarse UN meses para top 5% de puestos en 2013-2016 y 2016\n```{r, sueldo-puestos, echo=FALSE, fig.height=6, fig.width=10}\n     \n     #historico\n     top.ten.gral <- generales%>%filter(anio.ingreso >=2014, anio.ingreso <=2015, \n                                        puesto.fit %in% top.ten.puesto$puesto.fit,\n                                        sueldo>=700, sueldo < 1700)\n\n          pl5 <- ggplot(data = top.ten.gral, \n            aes(x = sueldo, y= unmes, colour = sexo)) +\n                 geom_count(alpha = 0.5) + \n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 geom_smooth(method = \"loess\", span = 0.8, se = FALSE, lwd=0.5) +\n                 facet_grid(~puesto.fit, scales = \"free\") +\n                 xlab(\"Sueldo semanal\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"Probabilidad vs sueldo por puesto 2013 a 2015\")\n     \n       suppressWarnings(ggplotly())\n       \n     #2016\n     top.ten.gral <- generales%>%filter(anio.ingreso >=2016, puesto.fit %in% top.ten.puesto$puesto.fit,\n                                        sueldo>=700, sueldo < 1700)\n     \n     pl5 <- ggplot(data = top.ten.gral, \n            aes(x = sueldo, y= unmes, colour = sexo)) +\n                 geom_count(alpha = 0.5) + \n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 geom_smooth(method = \"loess\", span = 1, se = FALSE, lwd=0.5) +\n                 facet_grid(~puesto.fit, scales = \"free\") +\n                 xlab(\"Sueldo semanal\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"Probabilidad vs sueldo por puesto 2016\")\n     \n       suppressWarnings(ggplotly())\n     \n```\n\n##EDAD\n###Probabilidad quedarse por EDAD\n```{r, edad-masculino, echo=FALSE, fig.height=6, fig.width=10}\n     for.fit.edad <- generales%>%\n          filter(anio.ingreso >= 2014, \n                 sueldo >= 700)\n\n     pl5 <- ggplot(data = for.fit.edad, \n            aes(x = edad.fit, y= unmes, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 xlab(\"Edad\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"UN MESES\")\n     \n     pl4 <- ggplot(data = for.fit.edad, \n            aes(x = edad.fit, y= tresmeses, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 1) +\n                 xlab(\"Edad\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"TRES MES\")\n     \n\n\n     \n     grid.arrange(pl5, pl4, ncol=2)\n     \n```\n\n###Detalles UN MES\n```{r edad-detalles-masc-tresmes,  echo=FALSE, fig.height=6, fig.width=10}\n     \n     pl5b <- ggplot(data = for.fit.edad, \n            aes(x = edad.fit, y= unmes, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 2) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) +\n                 geom_smooth(method = \"loess\", span = 0.8, se = FALSE, lwd=0.5) +\n                 xlab(\"Edad\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"Edad vs probabilidad de quedarse UN MESES\") + \n                scale_x_continuous(breaks = seq(16,70,2))\n\n     suppressWarnings(ggplotly())\n```\n\n##REINGRESOS\n###Probabilidad de quedarse un mes cuando reingresan\n```{r prob-reingresos,  echo=FALSE, fig.height=6, fig.width=10}\n     \n     for.fit.reingresos <- generales%>%\n          filter(anio.ingreso >= 2015, \n                 sueldo >= 700)%>%\n               mutate(\"reingresos.bool\" = ifelse(reingresos>0,1,0))\n\n     pbing <- ggplot(data = for.fit.reingresos, \n            aes(x = reingresos.bool, y= unmes, colour = factor(anio.ingreso))) +\n                 geom_count(alpha = 0.5) + \n                 facet_wrap(~sexo, scales = \"free\", ncol = 2) +\n                 geom_smooth(method = \"lm\", se = FALSE, lwd=0.5) +\n                 xlab(\"Reingresos\") +\n                 ylab(\"Probabilidad\") + \n                 ggtitle(\"Reingresos vs probabilidad de quedarse UN MESES\") +\n               scale_x_continuous(breaks = c(0,1), labels = c(\"Nuevo\",\"Reingresos\"))\n\n     suppressWarnings(ggplotly())\n```\n\n##CAMBIOS DE DEPARTAMENTO\n###Probabilidad de quedarse después de cambio (15 días)\n```{r prob-cambios,  echo=FALSE, fig.height=6, fig.width=10}\n     \n     for.fit.dias.cambio <- generales%>%\n          filter(anio.ingreso >= 2014, \n                 sueldo >= 700, !is.na(salio.por.cambio))\n\n     # !is.na(salio.por.cambio))%>%\n     #      group_by(anio.ingreso, salio.por.cambio)%>%\n     #      summarise(\"PERSONAS\" = n())\n\n     pbing <- ggplot(data = for.fit.dias.cambio, \n            aes(x = salio.por.cambio)) +\n                 geom_histogram(bins=2, fill = \"wheat\", col = \"navy\") + \n               facet_wrap(~anio.ingreso)+\n                 xlab(\"Bajas\") +\n                 ylab(\"Meses de antiguedad\") + \n                 ggtitle(\"Personal que se salio depues de un cambio\") +\n               scale_x_continuous(breaks = c(0,1), labels = c(\"Continuo\",\"Renuncio\"))\n\n     suppressWarnings(ggplotly())\n```\n\n",
    "created" : 1484265869823.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3768588735",
    "id" : "5F8538DC",
    "lastKnownWriteTime" : 1486078446,
    "last_content_update" : -2147483648,
    "path" : "~/Perugia/DelPersonal/AnalisisDelPersonal.Rmd",
    "project_path" : "AnalisisDelPersonal.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}